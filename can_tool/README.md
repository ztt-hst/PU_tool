# CAN协议上位机 - 创芯科技CANalyst-II版本

这是一个基于创芯科技CANalyst-II CAN转USB工具的上位机应用程序，实现了完整的CAN协议通信功能。

## 功能特性

1. **CAN通信设置**
   - 支持250/500kbps波特率设置
   - 支持创芯科技CANalyst-II设备
   - 支持双通道CAN通信

2. **自动发送功能**
   - 每秒发送ID为0x305的CAN报文
   - 每秒发送ID为0x307的CAN报文
   - 可配置发送间隔

3. **心跳监控**
   - 监控ID为0x351的CAN报文
   - 3秒未收到心跳报文时提示"BMS心跳终止"并断开连接
   - 实时显示心跳状态

4. **报文解析**
   - 解析ID为0x351、0x355、0x356和0x35A的CAN报文
   - 实时显示解析结果和统计信息

5. **日志记录**
   - 实时显示通信日志
   - 支持日志保存功能
   - 显示发送/接收统计

## 硬件要求

- 创芯科技CANalyst-II CAN转USB工具
- Windows操作系统
- USB接口

## 软件要求

- Python 3.6+
- tkinter (通常随Python安装)
- ctypes (Python标准库)

## 安装步骤

1. 确保ControlCAN.dll文件在程序目录下
2. 安装Python 3.6或更高版本
3. 运行程序：
   ```bash
   python can_host_computer.py
   ```

## 使用方法

1. **连接设备**
   - 将CANalyst-II设备连接到USB接口
   - 在程序中选择设备索引和CAN通道
   - 选择波特率（250kbps或500kbps）
   - 点击"连接"按钮

2. **开始通信**
   - 连接成功后，点击"启动发送"开始发送CAN报文
   - 程序会自动监控接收到的CAN报文
   - 查看日志了解通信状态

3. **监控状态**
   - 查看统计信息了解发送/接收数量
   - 监控心跳状态确保BMS通信正常
   - 使用日志功能记录通信过程

## 协议支持

本程序支持以下CAN报文ID：
- 0x305: 逆变器到BMS通信
- 0x307: 逆变器控制
- 0x351: BMS心跳
- 0x355: BMS状态
- 0x356: 电池信息
- 0x35A: 错误信息

## 注意事项

1. 确保ControlCAN.dll文件在程序目录下
2. 首次使用需要安装创芯科技驱动程序
3. 确保CAN设备正确连接到目标系统
4. 根据实际协议文档调整报文数据格式

## 故障排除

1. **连接失败**
   - 检查USB连接
   - 确认驱动程序已安装
   - 检查设备索引设置

2. **发送失败**
   - 检查CAN总线连接
   - 确认波特率设置正确
   - 检查目标设备是否在线

3. **心跳超时**
   - 检查BMS设备状态
   - 确认CAN总线连接正常
   - 检查报文ID设置

## 技术支持

如有问题，请检查：
1. 硬件连接是否正确
2. 驱动程序是否正确安装
3. 程序配置是否符合实际需求 